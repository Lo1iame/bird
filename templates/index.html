<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="static/css/index.css">
    <link rel="stylesheet" href="static/css/animate.min.css">
    <script src="static/js/vue.js"></script>
    <script src="static/js/axios.js"></script>
    <script src="static/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>
    <title>LoliMakeusFun</title>
</head>
<body>
    
    <!-- 视图:导航栏 -->
    <template id="i-header">
        <div class="header">
            <div class="logo wow rubberBand" :class="[scroll>500?'logo-scroll':'']">
                <span>LoliMakeusFun</span>
            </div>
            <div class="nav-btns wow fadeInDown"
            :style="{backgroundColor:formatColor}"
            >
                <div v-for="(n, i) in nav" :key="i" class="nav-btn">
                    <span>${n.text}</span>
                </div>
            </div>
            <div @click="openMenu" class="nav-menu"></div>
            <div v-if="navopen" class="nav-menu-content" :class="[navopen?'open':'']">
                <div  v-for="(n, i) in nav" :key="i" class="nav-menu-item wow fadeInRight" :data-wow-delay="i*0.25+'s'">
                    <div class="nav-icon">
                        <img :src="'static/imgs/menu/'+n.id+'.png'">
                    </div>
                    <div class="nav-text">
                        <span>${n.text}</span>
                    </div>
                </div>
            </div>
            
        </div>
    </template>

    <template id="i-image">
        <div class="image-view">
            <div class="image">
                <div class="hitokoto">

                    <span>${hitokoto.hitokoto}</span>
                </div>
                <div class="hitokoto-from">
                    <span>——《${hitokoto.from}》</span>
                </div>
                <div class="image-visited">
                    访问次数:${visited_times}
                </div>
            </div>
            <div class="blogger">
                <div class="blogger-info">
                    <div class="blogger-head">
                        <img src="static/imgs/blogger.png" />
                    </div>
                    <div class="blogger-name">
                        <span>Loriame</span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- 视图:根视图 -->
    <div id="app">
        <!-- 子组件:导航栏 -->
        <i-header @nav-btn-click="toView"></i-header>
        <i-image></i-image>
        <div style="height: 1000px;width: 100%"></div>
    </div>
</body>
<script>

        // 组件:导航栏
        Vue.component('i-header', {
            delimiters: ['${', '}'],
		    template:"#i-header",
            data:function(){
				return {
                    navopen:false,
                    nav:[
                        {id:"home",text:"首页",checked:true},
                        {id:"posts",text:"归档",checked:false},
                        {id:"res",text:"资源",checked:false},
                        {id:"about",text:"关于",checked:false},
                    ],
                    scroll:0
				}
			},
            mounted:function(){
                window.addEventListener('scroll', this.handleScroll, true);
            },
            computed: {
                formatColor:function(){
                    var scroll = this.scroll;
                    var rgb = 255-scroll/2>0?255-scroll/2:0;
                    var color = 'rgba('+rgb+','+rgb+','+rgb+',0.4)';
                    console.log(color);
                    return color;
                }
            },
            methods:{
                openMenu:function() {
                    this.navopen = !this.navopen;
                    console.log("侧边栏:"+this.navopen);
                    // this.$emit("open-menu");
                },
                handleScroll: function () {
                    this.scroll = document.documentElement.scrollTop || document.body.scrollTop;
                    console.log(this.scroll)
                }
                
            }
        });

        // 组件:背景图
        Vue.component('i-image', {
            delimiters: ['${', '}'],
		    template:"#i-image",
            data:function(){
				return {
                    visited_times:0,
                    hitokoto:{}
                }
            },
            mounted() {
                this.get_visited_times();
                this.get_hitokoto();
            },
            methods:{
                //获取主页访问次数
                get_visited_times:function(){
                    var _this = this;
                    axios.get("/visited_times/")
                    .then(function(response){
                        console.log(response.data);
                        _this.visited_times = response.data.visited_times;
                    })
                    .catch(function(e){
                        console.log(e);
                    });
                },
                //获取一言
                get_hitokoto:function(){
                    var _this = this;
                    axios.get("https://v1.hitokoto.cn/?c=a")
                    .then(function(response){
                        console.log(response.data);
                        _this.hitokoto = response.data;
                    })
                    .catch(function(e){
                        console.log(e);
                    });
                }
            }
        });


        //Vue实例,根视图
		var app = new Vue({
			delimiters: ['${', '}'],
			el:"#app",
			data:function(){
				return {
                    navopen:false,
                    views:{
                        home:true,
                    }
				}
			},
			methods:{
                toView:function(id){
                    console.log("View Changed."); 
                    for (var key in this.views) {
                        if (key == id) {
                            this.views[key]=true;
                            console.log("当前视图:"+key); 
                            
                        }else{
                            this.views[key]=false;
                        }
                    }
                },
            }
		});

        
</script>
</html>